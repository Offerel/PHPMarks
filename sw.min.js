const VERSION="v1.1",urlB64ToUint8Array=base64String=>{const padding="=".repeat((4-base64String.length%4)%4),base64=(base64String+padding).replace(/\-/g,"+").replace(/_/g,"/"),rawData=atob(base64),outputArray=new Uint8Array(rawData.length);for(let i=0;i<rawData.length;++i)outputArray[i]=rawData.charCodeAt(i);return outputArray},saveSubscription=async subscription=>{const SERVER_URL="http://localhost:4000/save-subscription",response=await fetch(SERVER_URL,{method:"post",headers:{"Content-Type":"application/json"},body:JSON.stringify(subscription)});return response.json()};var CACHE_NAME="syncmarks-cache-v1",urlsToCache=["./images/bookmarks.ico","sw.js","manifest.json","bookmarks.css","bookmarks.js"];log("loading sw"),self.addEventListener("install",(function(event){log("installing sw"),event.waitUntil(caches.open(CACHE_NAME).then((function(cache){log("Opened cache");var x=cache.addAll(urlsToCache);return log("cache added"),x})))})),self.addEventListener("activate",async()=>{log("now ready to handle fetches!");try{const applicationServerKey=urlB64ToUint8Array("BE6UpubD129XALrqUG3s4nznMIFmbE1uB_vnQREO-AbW2ziMXU1oFCps2s4sqzTZuNiI3oO0keNs4656PYlgN1Q"),options={applicationServerKey:applicationServerKey,userVisibleOnly:!0},subscription=await self.registration.pushManager.subscribe(options);log(JSON.stringify(subscription))}catch(err){log("Error",err)}}),self.addEventListener("push",(function(event){var dstamp=Date.now();if(event.data)for(let i=0;i<2;i++)showLocalNotification("Seite von Quelle",event.data.text(),self.registration,dstamp);else log("Error: Wrong data")})),self.addEventListener("fetch",(function(event){const url=new URL(event.request.url);log(url),event.respondWith(caches.match(event.request).then((function(response){return response||fetch(event.request)})))})),self.addEventListener("sync",event=>{"messages"==event.tag&&event.waitUntil(syncMessages())}),self.addEventListener("periodicsync",event=>{"get-latest-news"==event.tag&&event.waitUntil(fetchAndCacheLatestNews())});const showLocalNotification=(title,body,swRegistration,dstamp)=>{const options={body:body,icon:"./images/bookmarks.ico",tag:dstamp,renotify:!1};swRegistration.showNotification(title,options)};function log(message){console.log("v1.1",message)}function syncMessages(){fetch("index.php?gurls=1").then((function(response){return response.json()})).then((function(data){console.log(data),send(data.title,data.url)}))}function ask_for_permission(){Notification.requestPermission((function(){}))}function send(title,message){self.registration.showNotification(title,{body:message,icon:"./images/bookmarks.ico"})}self.addEventListener("notificationclick",(function(event){log("On notification click: ",event.notification),event.notification.close(),clients.openWindow(event.notification.body)}));