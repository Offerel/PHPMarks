var menu=document.querySelector(".menu"),bookmarks=document.querySelectorAll(".file").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1));if(/Mobi|Android/i.test(navigator.userAgent)){var ffolder=[];$(".ffolder").on("change",(function(){this.checked?ffolder.push(this.value):(ffolder.splice(ffolder.indexOf(this.value),1),location.reload());var actFolder="f_"+ffolder[ffolder.length-1];"f_undefined"!=actFolder&&($(".actFolder").removeClass("actFolder"),$("#"+actFolder+" li").addClass("actFolder"),$(".mainFolder > label").css("z-index",0),$("#"+actFolder).addClass("actFolder mainFolder"),$(".mainFolder").addClass("actFolder"),$("li:not(.actFolder)").hide())}))}function checkuform(){$("#nuser").val().length>0&&$("#npwd").val().length&&$("#userLevel").val().length>0?($("#muadd").removeAttr("disabled","disabled"),$("#mudel").removeAttr("disabled","disabled")):($("#muadd").attr("disabled","disabled"),$("#mudel").attr("disabled","disabled")),$("#userSelect").val().length<1&&$("#mudel").attr("disabled","disabled")}function moveEnd(content){var char=3e3,sel;content.focus(),window.getSelection().collapse(content.firstChild,3e3)}function delBookmark(id,title){confirm('Would you like to delete "'+title+'"?')&&$.ajax({url:document.location.href,type:"POST",data:{mdel:!0,id:id},success:function(r){$("#bookmarks").html(r);var bookmarks=document.querySelectorAll(".file").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1))}})}function enableSave(){var url=document.getElementById("url"),save=document.getElementById("save");url.value.length>7?save.disabled=!1:save.disabled=!0}function showMenu(x,y){var minbot=$(window).height()-120;y>=minbot&&(y=minbot),menu.style.left=x+"px",menu.style.top=y+"px",menu.classList.add("show-menu")}function hideMenu(){menu.classList.remove("show-menu"),$(".mmenu").hide(),$(".mbmdialog").hide(),document.querySelector("#bookmarks").removeEventListener("click",hideMenu,!1)}function onContextMenu(e){e.preventDefault(),$(".mbmdialog").hide(),$(".mmenu").hide(),$("#bmid").prop("value",e.srcElement.attributes.id.value),$("#bmid").prop("title",e.srcElement.attributes.title.value),showMenu(e.pageX,e.pageY),document.querySelector("#btnEdit").addEventListener("click",onClick,!1),document.querySelector("#btnMove").addEventListener("click",onClick,!1),document.querySelector("#btnDelete").addEventListener("click",onClick,!1)}function onClick(e){var minleft=155,minbot=$(window).height()-200,xpos=e.pageX,ypos=e.pageY;switch(xpos<=155&&(xpos=155),ypos>=minbot&&(ypos=minbot),this.id){case"btnEdit":$("#bmarkedt #edtitle").val($("#bmid").prop("title")),$("#bmarkedt #edurl").val($("#"+$("#bmid").prop("value")).attr("href")),$("#bmarkedt #edid").val($("#bmid").prop("value")),$(".mbmdialog").hide(),$(".mmenu").hide(),$("#bmarkedt").show(),$("#bmarkedt").css("left",xpos),$("#bmarkedt").css("top",ypos);break;case"btnMove":$(".mbmdialog").hide(),$(".mmenu").hide(),$("#bmamove").show(),$("#bmamove #mvtitle").val($("#bmid").prop("title")),$("#bmamove #mvid").val($("#bmid").prop("value")),$("#bmamove").css("left",xpos),$("#bmamove").css("top",ypos);break;case"btnDelete":delBookmark($("#bmid").prop("value"),$("#bmid").prop("title"))}hideMenu(),document.removeEventListener("click",onClick)}$(document).keydown((function(e){27==e.keyCode&&($(".mbmdialog").hide(),$(".mmenu").hide())})),$("#mngcform li div.clientname input[type='text']").on("focus",(function(){$(this).select()})),$("#save").on("click",(function(){return $.ajax({url:document.location.href,type:"POST",data:{madd:!0,folder:$("#folder").val(),url:$("#url").val()},success:function(r){$(".mmenu").hide(),$("#bookmarks").html(r),$("#bmarkadd").hide()}}),!1})),$("#mlogout").on("click",(function(){return $.ajax({url:document.location.href,type:"POST",data:{logout:!0},statusCode:{401:function(){$("body").html("Successfully logged out...")}}}),!1})),$("#userSelect").on("change",(function(){$(this).val()>0&&($("#nuser").val($("#userSelect option:selected").text()),checkuform(),$("#muadd").val("Edit User"),$("#mudel").removeAttr("disabled","disabled"))})),$("#npwd").on("input",(function(){checkuform()})),$("#nuser").on("input",(function(){checkuform()})),$("#userLevel").on("change",(function(){checkuform()})),$("#hmenu").on("click",(function(){$("#menu button").css("background-color","transparent"),$(".mbmdialog").hide(),"none"==$("#mainmenu").css("display")?($(".mmenu").hide(),$("#mainmenu").show()):$("#mainmenu").hide(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#mngusers").on("click",(function(){$(".mmenu").hide(),$("#mnguform").show(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#muser").on("click",(function(){$(".mbmdialog").hide(),$(".mmenu").hide(),$("#userform").show(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$(".mdcancel").on("click",(function(){$(".mbmdialog").hide(),$(".mmenu").hide()})),$("#mpassword").on("click",(function(){$(".mbmdialog").hide(),$(".mmenu").hide(),$("#passwordform").show(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#pbullet").on("click",(function(){$(".mbmdialog").hide(),$(".mmenu").hide(),$("#pbulletform").show(),console.log("Pushbullet"),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#clientedt").on("click",(function(){$(".mmenu").hide(),$("#mngcform").show(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#bexport").on("click",(function(){$(".mmenu").hide();var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();return dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),today=dd+"-"+mm+"-"+yyyy,$.ajax({url:document.location.href,type:"POST",data:{export:"html"},success:function(data){var blob=new Blob([data],{type:"text/html"}),link=document.createElement("a");link.href=window.URL.createObjectURL(blob),link.download="bookmarks_"+today+".html",link.click()}}),!1})),$("#footer").on("click",(function(){document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),$("#bmarkadd").show(),$(".mmenu").hide(),url.focus(),url.addEventListener("input",enableSave),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),$("#mlog").on("click",(function(){$(".mmenu").hide(),"hidden"===$("#logfile").css("visibility")?($("#logfile").css("visibility","visible"),$("#close").css("visibility","visible"),$.ajax({url:document.location.href,type:"POST",data:{mlog:!0},success:function(r){$("#logfile").html(r),moveEnd($("#logfile"))}})):($("#logfile").css("visibility","hidden"),$("#close").css("visibility","hidden"))})),$("#mclear").on("click",(function(){"visible"===$("#logfile").css("visibility")&&($("#logfile").css("visibility","hidden"),$("#close").css("visibility","hidden"),$.ajax({url:document.location.href,type:"POST",data:{mclear:!0},success:function(r){}}))})),$("#mclose").on("click",(function(){"visible"===$("#logfile").css("visibility")&&($("#logfile").css("visibility","hidden"),$("#close").css("visibility","hidden"))})),$("#mngcform li div.rename").on("click",(function(){$.ajax({type:"POST",url:"index.php",data:{arename:!0,cido:$(this)[0].parentElement.id,nname:$(this)[0].parentElement.children[0].children[0].value},success:function(a){response=JSON.parse(a),(response=1)?location.reload(!1):console.log("Error renaming client")}})})),$("#mngcform li div.remove").on("click",(function(){$.ajax({type:"POST",url:"index.php",data:{adel:!0,cido:$(this)[0].parentElement.id},success:function(a){response=JSON.parse(a),(response=1)?location.reload(!1):console.log("Error removing client")}})})),$("#mngcform li div.clientname input").on("mouseleave",(function(){$(this)[0].defaultValue!=$(this)[0].value&&($("#"+$(this)[0].parentElement.parentElement.id+" div.clientname input").css("display","block"),$("#"+$(this)[0].parentElement.parentElement.id+" div.rename").css("display","block"),$("#"+$(this)[0].parentElement.parentElement.id+" div.remove").css("display","block"))})),$("#edtitle").on("input",(function(){$("#edsave").prop("disabled",!1)})),$("#edurl").on("input",(function(){$("#edsave").prop("disabled",!1)})),$("#mvfolder").on("change",(function(){$("#mvsave").prop("disabled",!1)})),$("#edsave").on("click",(function(e){return e.preventDefault(),$.ajax({url:document.location.href,type:"POST",data:{bmedt:!0,title:$("#edtitle").val(),url:$("#edurl").val(),id:$("#edid").val()},success:function(r){1==r?location.reload():console.log("There was a problem changing that bookmark.")}}),!1})),$("#mvsave").on("click",(function(e){return e.preventDefault(),$.ajax({url:document.location.href,type:"POST",data:{bmmv:!0,title:$("#mvtitle").val(),folder:$("#mvfolder").val(),id:$("#mvid").val()},success:function(r){1==r?location.reload():console.log("There was a problem moving that bookmark.")}}),!1})),jQuery.expr[":"].Contains=function(a,i,m){return jQuery(a).text().toUpperCase().indexOf(m[3].toUpperCase())>=0},$("#menu input").keyup((function(e){var sfilter=$(this).val(),allmarks=$("#bookmarks li.file");$("#bookmarks").html(allmarks),$("#bookmarks li.file:not(:Contains("+sfilter+"))").css("display","none"),$("#bookmarks li.file:Contains("+sfilter+")").css("display","block"),$("#bookmarks li.file:Contains("+sfilter+")").css("padding-left","20px"),""!=sfilter&&27!=e.keyCode||($("#bookmarks").html($("#hmarks").html()),$("#menu input").val(""))})),$("#menu button").on("click",(function(){"×"==$("#menu button").html()?($("#menu input").blur(),$("#menu button").html("⌕"),$("#menu button").css("background-color","transparent"),$("#menu input").css("width","0"),$("#menu input").css("background-color","transparent"),$("#menu input").css("border","1px solid transparent"),$("#mprofile").show()):($("#menu button").html("×"),$("#menu button").css("background-color","#05589D"),$("#menu input").css("width","calc(100% - 100px)"),$("#menu input").css("background-color","#05589D"),$("#mprofile").hide(),$("#menu input").focus()),$(".mbmdialog").hide(),$(".mmenu").hide()}));