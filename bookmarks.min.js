/**
 * SyncMarks
 *
 * @version 1.3.1
 * @author Offerel
 * @copyright Copyright (c) 2021, Offerel
 * @license GNU General Public License, version 3
 */
function delClient(element){let xhr=new XMLHttpRequest,data="caction=adel&cido="+element.target.parentElement.id;xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(document.getElementById("mngcform").innerHTML=xhr.responseText,document.querySelectorAll("#mngcform li div.remove").forEach((function(element){element.addEventListener("click",delClient,!1)})),document.querySelectorAll("#mngcform li div.rename").forEach((function(element){element.addEventListener("click",mvClient,!1)})))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}function mvClient(element){let xhr=new XMLHttpRequest,data="caction=arename&cido="+element.target.parentElement.id+"&nname="+element.target.parentElement.children[0].children.cname.value;xhr.onreadystatechange=function(){4==xhr.readyState&&200==xhr.status&&(document.getElementById("mngcform").innerHTML=xhr.responseText,document.querySelectorAll("#mngcform li div.remove").forEach((function(element){element.addEventListener("click",delClient,!1)})),document.querySelectorAll("#mngcform li div.rename").forEach((function(element){element.addEventListener("click",mvClient,!1)})))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}function resize(e){let wdt=window.innerWidth-parseInt(e.x);document.getElementById("logfile").style.width=wdt+"px"}function checkuform(){document.getElementById("nuser").value.length>0&&document.getElementById("npwd").value.length>0&&document.getElementById("userLevel").value.length>0?(document.getElementById("muadd").disabled=!1,document.getElementById("mudel").disabled=!1):(document.getElementById("muadd").disabled=!0,document.getElementById("mudel").disabled=!0),document.getElementById("userSelect").value.length<1&&(document.getElementById("mudel").disabled=!0)}function moveEnd(){let lfiletext=document.getElementById("lfiletext");lfiletext.scrollTop=lfiletext.scrollHeight}function delBookmark(id,title){if(confirm('Would you like to delete "'+title+'"?')){let xhr=new XMLHttpRequest,data="caction=mdel&id="+id;xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?(hideMenu(),document.getElementById("bookmarks").innerHTML=this.responseText,document.querySelectorAll(".file").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".folder").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1))):console.log("There was a problem removing that bookmark."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}}function enableSave(){document.getElementById("url").value.length>7?document.getElementById("save").disabled=!1:document.getElementById("save").disabled=!0}function showMenu(x,y){var menu=document.querySelector(".menu"),minbot=window.innerHeight-120;y>=minbot&&(y=minbot),menu.style.left=x+"px",menu.style.top=y+"px",menu.style.opacity=1,menu.classList.add("show-menu")}function hideMenu(){let menu=document.querySelector(".menu");menu.classList.remove("show-menu"),menu.style.display="none",document.querySelectorAll(".mmenu").forEach((function(item){item.style.display="none"})),document.querySelectorAll(".mbmdialog").forEach((function(item){item.style.display="none"}))}function onContextMenu(e){let menu;e.preventDefault(),hideMenu(),document.querySelector(".menu").style.display="block",e.target.attributes.id?(document.getElementById("bmid").value=e.target.attributes.id.value,document.getElementById("bmid").title=e.target.attributes.title.value,document.getElementById("btnMove").setAttribute("style","display:block !important"),document.getElementById("btnFolder").setAttribute("style","display:block !important")):(document.getElementById("bmid").value=e.target.nextElementSibling.value,document.getElementById("bmid").title=e.target.textContent,document.getElementById("btnMove").setAttribute("style","display:none !important"),document.getElementById("btnFolder").setAttribute("style","display:none !important")),showMenu(e.pageX,e.pageY),document.querySelector("#btnEdit").addEventListener("click",onClick,!1),document.querySelector("#btnMove").addEventListener("click",onClick,!1),document.querySelector("#btnDelete").addEventListener("click",onClick,!1),document.querySelector("#btnFolder").addEventListener("click",onClick,!1)}function onClick(e){var minleft=155,minbot=window.innerHeight-200,xpos=e.pageX,ypos=e.pageY;switch(xpos<=155&&(xpos=155),ypos>=minbot&&(ypos=minbot),this.id){case"btnEdit":document.getElementById("edtitle").value=document.getElementById("bmid").title,document.getElementById("edid").value=document.getElementById("bmid").value,document.getElementById(document.getElementById("bmid").value)?(document.getElementById("edurl").value=document.getElementById(document.getElementById("bmid").value).href,document.getElementById("bmarkedt").firstChild.innerText="Edit Bookmark",document.getElementById("edurl").type="text"):(document.getElementById("edurl").value="",document.getElementById("edurl").type="hidden",document.getElementById("bmarkedt").firstChild.innerText="Edit Folder"),hideMenu(),document.getElementById("bmarkedt").style.left=xpos,document.getElementById("bmarkedt").style.top=ypos,document.getElementById("bmarkedt").style.display="block";break;case"btnMove":document.getElementById("mvtitle").value=document.getElementById("bmid").title,document.getElementById("mvid").value=document.getElementById("bmid").value,hideMenu(),document.getElementById("bmamove").style.left=xpos,document.getElementById("bmamove").style.top=ypos,document.getElementById("bmamove").style.display="block";break;case"btnDelete":delBookmark(document.getElementById("bmid").value,document.getElementById("bmid").title);break;case"btnFolder":hideMenu(),document.getElementById("folderf").style.left=xpos,document.getElementById("folderf").style.top=ypos,document.getElementById("folderf").style.display="block",document.getElementById("fbid").value=document.getElementById("bmid").value}document.removeEventListener("click",onClick)}function openMessages(element){var i,tabcontent,tablinks;for(tabcontent=document.getElementsByClassName("tabcontent"),i=0;i<tabcontent.length;i++)tabcontent[i].style.display="none";for(tablinks=document.getElementsByClassName("tablinks"),i=0;i<tablinks.length;i++)tablinks[i].className=tablinks[i].className.replace(" active","");document.getElementById(element.target.dataset.val).style.display="block",element.currentTarget.className+=" active"}function delMessage(message){let loop=message.target.parentElement.parentElement.parentElement.parentElement.parentElement.id,xhr=new XMLHttpRequest,data="caction=rmessage&lp="+loop+"&message="+message.target.dataset.message;xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&(document.querySelector("#"+loop+" .NotiTable .NotiTableBody").innerHTML=this.responseText,document.querySelectorAll(".NotiTableCell .fa-trash-o").forEach((function(element){element.addEventListener("click",delMessage,!1)})))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}function eNoti(e){var nval;if(e.target.checked)if("Notification"in window)if("granted"===Notification.permission){var notification=new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}else"denied"!==Notification.permission&&Notification.requestPermission().then((function(permission){if("granted"===permission){var notification=new Notification("Syncmarks",{body:"Notifications will be enabled for Syncmarks.",icon:"./images/bookmarks192.png"});setOption("notifications",1)}}));else alert("This browser does not support desktop notification"),setOption("notifications",0);else setOption("notifications",0)}function setOption(option,val){let xhr=new XMLHttpRequest,data="caction=soption&option="+option+"&value="+val;xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&("1"===this.responseText?console.log("Option saved."):alert("Error saving option, please check server log"))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}function rNot(noti){let xhr=new XMLHttpRequest,data="caction=durl&durl="+noti;xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&("1"===this.responseText?console.log("Notification removed"):alert("Problem removing notification, please check server log."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}function show_noti(noti){if("granted"!==Notification.permission)Notification.requestPermission();else{let notification;new Notification(noti.title,{body:noti.url,icon:"./images/bookmarks192.png",requireInteraction:!0}).onclick=function(){window.open(noti.url),rNot(noti.nkey)}}}function getNotifications(){let xhr=new XMLHttpRequest,data="caction=gurls";xhr.onreadystatechange=function(){if(4==this.readyState&&200==this.status&&this.responseText){let notifications=JSON.parse(this.responseText);1==notifications[0].nOption&&notifications.forEach((function(notification){show_noti(notification)}))}},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data),sessionStorage.setItem("gNoti","1")}document.addEventListener("DOMContentLoaded",(function(){document.querySelector("#menu input").addEventListener("keyup",(function(e){var sfilter=this.value,allmarks=document.querySelectorAll("#bookmarks li.file"),bdiv=document.getElementById("bookmarks");bdiv.innerHTML="",allmarks.forEach(bookmark=>{bdiv.appendChild(bookmark),bookmark.innerText.toUpperCase().includes(sfilter.toUpperCase())||bookmark.firstChild.attributes.href.nodeValue.toUpperCase().includes(sfilter.toUpperCase())?(bookmark.style.display="block",bookmark.style.paddingLeft="20px"):bookmark.style.display="none"}),""!=sfilter&&27!=e.keyCode||(bdiv.innerHTML=document.getElementById("hmarks").innerHTML,document.querySelector("#menu input").value="")})),document.querySelector("#menu button").addEventListener("click",(function(){"×"==document.querySelector("#menu button").innerHTML?(document.querySelector("#menu input").blur(),document.querySelector("#menu button").innerHTML="⌕",document.querySelector("#menu button").classList.remove("asform"),document.querySelector("#menu input").classList.remove("asform"),document.querySelector("#menu input").classList.add("isform"),document.getElementById("mprofile").style.display="block"):(document.querySelector("#menu button").innerHTML="×",document.querySelector("#menu button").classList.add("asform"),document.querySelector("#menu input").classList.remove("isform"),document.querySelector("#menu input").classList.add("asform"),document.getElementById("mprofile").style.display="none",document.querySelector("#menu input").focus()),hideMenu()})),document.getElementById("logfile").addEventListener("mousedown",(function(e){e.offsetX<3&&document.addEventListener("mousemove",resize,!1)}),!1),document.addEventListener("mouseup",(function(){document.removeEventListener("mousemove",resize,!1)}),!1),document.querySelectorAll(".file").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".folder").forEach(bookmark=>bookmark.addEventListener("contextmenu",onContextMenu,!1)),document.querySelectorAll(".tablinks").forEach(tab=>tab.addEventListener("click",openMessages,!1)),document.querySelectorAll(".NotiTableCell .fa-trash-o").forEach(message=>message.addEventListener("click",delMessage,!1)),document.querySelector("#cnoti").addEventListener("change",eNoti,!1),1!=sessionStorage.getItem("gNoti")&&getNotifications(),document.addEventListener("keydown",e=>{27===e.keyCode&&hideMenu()}),document.querySelector("#mngcform input[type='text']")&&document.querySelector("#mngcform input[type='text']").addEventListener("focus",(function(){this.select()})),document.getElementById("save")&&document.getElementById("save").addEventListener("click",(function(event){event.preventDefault(),hideMenu();let folder=document.getElementById("folder").value,url=encodeURIComponent(document.getElementById("url").value);var xhr=new XMLHttpRequest,data="caction=madd&folder="+folder+"&url="+url;xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?(document.getElementById("bookmarks").innerHTML=this.responseText,console.log("Bookmark added successfully.")):alert("Error adding bookmark, please check server log."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)})),document.getElementById("userSelect").addEventListener("change",(function(){this.value>0&&(document.getElementById("nuser").value=document.querySelector("#userSelect option:checked").text,checkuform(),document.getElementById("muadd").value="Edit User",document.getElementById("mudel").disabled=!1)})),document.getElementById("npwd").addEventListener("input",(function(){checkuform()})),document.getElementById("nuser").addEventListener("input",(function(){checkuform()})),document.getElementById("userLevel").addEventListener("input",(function(){checkuform()})),document.getElementById("hmenu").addEventListener("click",(function(){var mainmenu=document.getElementById("mainmenu");document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),"block"===mainmenu.style.display?mainmenu.style.display="none":(hideMenu(),mainmenu.style.display="block")})),document.getElementById("mngusers").addEventListener("click",(function(){hideMenu(),document.getElementById("mnguform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("muser").addEventListener("click",(function(e){e.preventDefault(),hideMenu(),document.getElementById("userform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.querySelectorAll(".mdcancel").forEach(button=>button.addEventListener("click",(function(){hideMenu()}))),document.getElementById("mpassword").addEventListener("click",(function(){hideMenu(),document.getElementById("passwordform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("pbullet").addEventListener("click",(function(){hideMenu(),document.getElementById("pbulletform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("nmessages").addEventListener("click",(function(){hideMenu(),document.getElementById("nmessagesform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("clientedt").addEventListener("click",(function(){hideMenu(),document.getElementById("mngcform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("psettings").addEventListener("click",(function(){hideMenu(),document.getElementById("mngsform").style.display="block",document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1)})),document.getElementById("bexport").addEventListener("click",(function(){hideMenu();var today=new Date,dd=today.getDate(),mm=today.getMonth()+1,yyyy=today.getFullYear();dd<10&&(dd="0"+dd),mm<10&&(mm="0"+mm),today=dd+"-"+mm+"-"+yyyy;var xhr=new XMLHttpRequest,data="caction=fexport&type=html";return xhr.onreadystatechange=function(){if(4==this.readyState)if(200==this.status){var blob=new Blob([this.responseText],{type:"text/html"}),link=document.createElement("a");link.href=window.URL.createObjectURL(blob),link.download="bookmarks_"+today+".html",link.click(),console.log("HTML successfully, please look in your download folder.")}else alert("Error generating export, please check server log.")},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data),!1})),document.getElementById("footer")&&document.getElementById("footer").addEventListener("click",(function(){hideMenu(),document.querySelector("#bookmarks").addEventListener("click",hideMenu,!1),document.getElementById("bmarkadd").style.display="block",url.focus(),url.addEventListener("input",enableSave)})),document.getElementById("mlog").addEventListener("click",(function(){hideMenu();let logfile=document.getElementById("logfile");if("visible"===logfile.style.visibility)logfile.style.visibility="hidden",document.getElementById("close").style.visibility="hidden";else{logfile.style.visibility="visible",document.getElementById("close").style.visibility="visible";let xhr=new XMLHttpRequest,data="caction=mlog";xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?(document.getElementById("lfiletext").innerHTML=this.responseText,moveEnd()):alert("Error loading logfile, please check server log."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}})),document.getElementById("mclear").addEventListener("click",(function(){let logfile=document.getElementById("logfile");if("visible"===logfile.style.visibility){logfile.style.visibility="hidden",document.getElementById("close").style.visibility="hidden";let xhr=new XMLHttpRequest,data="caction=mclear";xhr.onreadystatechange=function(){4==this.readyState&&(200==this.status?console.log("Logfile should now be empty."):console.log("Error couldnt clear logfile."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data)}})),document.getElementById("mclose").addEventListener("click",(function(){"visible"===document.getElementById("logfile").style.visibility&&(document.getElementById("logfile").style.visibility="hidden",document.getElementById("close").style.visibility="hidden")})),document.querySelectorAll("#mngcform .clientname").forEach((function(e){e.addEventListener("touchstart",(function(){this.children[0].style.display="block"}))})),document.querySelectorAll("#mngcform li div.rename").forEach((function(element){element.addEventListener("click",mvClient,!1)})),document.querySelectorAll("#mngcform li div.remove").forEach((function(element){element.addEventListener("click",delClient,!1)})),document.querySelectorAll("#mngcform li div.clientname input").forEach((function(element){element.addEventListener("mouseleave",(function(){this.defaultValue!=this.value&&(this.style.display="block",this.parentElement.parentElement.children[2].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.add("renamea"),this.parentElement.parentElement.children[1].classList.remove("rename"),this.parentElement.parentElement.children[2].classList.remove("remove"))}))})),document.getElementById("fname")&&document.getElementById("fname").addEventListener("input",(function(){document.getElementById("fsave").disabled=!1})),document.getElementById("edtitle")&&document.getElementById("edtitle").addEventListener("input",(function(){document.getElementById("edsave").disabled=!1})),document.getElementById("edurl")&&document.getElementById("edurl").addEventListener("input",(function(){document.getElementById("edsave").disabled=!1})),document.getElementById("mvfolder")&&document.getElementById("mvfolder").addEventListener("change",(function(){document.getElementById("mvsave").disabled=!1})),document.getElementById("fsave")&&document.getElementById("fsave").addEventListener("click",(function(e){e.preventDefault();let xhr=new XMLHttpRequest,data="caction=cfolder&fname="+document.getElementById("fname").value+"&fbid="+document.getElementById("fbid").value;return xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==this.responseText?location.reload(!1):console.log("There was a problem adding the new folder."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data),hideMenu(),!1})),document.getElementById("edsave")&&document.getElementById("edsave").addEventListener("click",(function(e){e.preventDefault();let xhr=new XMLHttpRequest,data="caction=bmedt&title="+document.getElementById("edtitle").value+"&url="+document.getElementById("edurl").value+"&id="+document.getElementById("edid").value;return xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==this.responseText?location.reload(!1):console.log("There was a problem changing that bookmark."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data),!1})),document.getElementById("mvsave")&&document.getElementById("mvsave").addEventListener("click",(function(e){e.preventDefault();let xhr=new XMLHttpRequest,data="caction=bmmv&title="+document.getElementById("mvtitle").value+"&folder="+document.getElementById("mvfolder").value+"&id="+document.getElementById("mvid").value;return xhr.onreadystatechange=function(){4==this.readyState&&200==this.status&&(1==this.responseText?location.reload(!1):console.log("There was a problem moving that bookmark."))},xhr.open("POST",document.location.href,!0),xhr.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),xhr.send(data),!1}))}),!1);